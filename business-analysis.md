 # KURATOR — Бизнес-анализ (ТЗ без технической реализации)
 
 ## 1. Цель и контекст
 
 KURATOR — система управления контактами и взаимодействиями по секторам (блокам), с разграничением доступа:
 - Администратор — видит и управляет всем.
 - Куратор — работает в своих блоках; может быть назначен основным или резервным в каждом конкретном блоке.
 - Аналитик угроз — доступ к отдельному реестру потенциальных угроз (Watchlist).
 
 Основные возможности:
 - Ведение реестра контактов и касаний, отслеживание статусов влияния и истории изменений.
 - Отдельный Watchlist для наблюдения и оценки потенциальных угроз.
 - FAQ/Правила для стандартизации работы.
 - Аудит действий пользователей.
 - Дашборды для кураторов и администраторов.
 - Политики безопасности (MFA для всех, политика деактивации записей).
 
 
 ## 2. Роли и права (бизнес-уровень)
 
 - Администратор:
   - Управление пользователями и блоками.
   - Настройка справочников.
   - Просмотр всех контактов, касаний, аудит-логов и аналитики.
   - Деактивация записей (мягкое удаление).
 - Куратор:
   - Доступ только к своим блокам (там, где назначен основным или резервным).
   - Создание/редактирование контактов и касаний.
   - Изменение статусов влияния.
   - Просмотр истории касаний и статусов.
 - Аналитик угроз:
   - Доступ к Watchlist.
   - Назначение ответственных наблюдателей (только среди аналитиков угроз).
   - Нет доступа к основному реестру контактов.
 
 Примечание о «резервном кураторе»: это статус назначения куратора в блоке, а не отдельная роль. Резервный работает параллельно с основным с теми же правами в этом блоке.
 
 
 ## 3. Основные сущности и бизнес‑правила
 
 ### 3.1. Блок
 - Название, описание, статус (Активный/Архив), код блока (BLOCKCODE, напр. OP, SIL).
 - При архивации: данные не удаляются, но блок и его данные не видны кураторам и не участвуют в аналитике; администратор может восстановить.
 - В блоке назначается основной и (опционально) резервный куратор.
 
 ### 3.2. Пользователи
 - Создаются только администратором (без саморегистрации).
 - Привязка куратора к одному или нескольким блокам обязательна (куратора без блока быть не может).
 - MFA обязательна для всех пользователей; настраивается при первом входе.
 
 ### 3.3. Контакт
 - Идентификатор: `BLOCKCODE-###` (трёхзначная нумерация в пределах блока).
 - Ключевые поля: блок, ФИО, орган/структура (из справочника), роль/должность, статус влияния (A/B/C/D), тип влияния (из справочника), канал, источник, даты последнего и следующего касания, ответственный куратор, примечания.
 - Дата последнего касания обновляется только добавлением касания.
 - Политика Next_touch_date:
   - При создании касания с заполненным Next_touch_date — дата в контакте всегда перезаписывается.
   - Ручное изменение возможно в карточке контакта; будет перезаписано при следующем касании, если оно содержит дату.
   - Редактирование старого касания не меняет Next_touch_date.
 - Статус записи: Активный / Деактивирован (мягкое удаление).
 - Ограничения поиска и сортировки над чувствительными полями:
   - Поиск на сервере осуществляется только по НЕшифрованным полям: ID контакта, блок, орган/структура, статус влияния, тип влияния, источник, даты.
   - Поиск/сортировка по ФИО выполняются на клиенте после загрузки и расшифровки данных.
 
 ### 3.4. Касание (Interaction)
 - Ключевые поля: контакт, дата/время, тип касания, результат, комментарий/детали, изменение статуса влияния, вложения, следующая дата касания.
 - Статус записи: Активный / Деактивирован (мягкое удаление).
 - Касание можно создавать из раздела «Касания» или из карточки контакта.
 
 ### 3.5. История статуса влияния
 - Автоматическая фиксация всех изменений статуса влияния (дата, кто изменил, с какого на какой).
 - Отображается в карточке контакта.
 
 ### 3.6. Audit Log (журнал действий)
 - Фиксируются ключевые действия пользователей.
 - Хранит: кто, когда, над чем, какие старые/новые значения.
 - Для действий создания old_value = NULL.
 - Доступен для просмотра администратору с фильтрами.
 
 
 ## 4. Интерфейс и UX‑требования
 
 ### 4.1. Язык интерфейса
 - Весь интерфейс — на русском языке (тексты, валидация, сообщения, подписи).
 - Исключения: тех. идентификаторы/коды, логины, сообщения в логах.
 
 ### 4.2. Экранные разделы
 - Куратор:
   - Контакты (поиск/фильтры/создание).
   - Касания (журнал/создание).
   - FAQ/Правила (просмотр).
   - Дашборд (активность и напоминания).
 - Администратор:
   - Блоки (CRUD, назначение кураторов).
   - Пользователи (управление, привязка к блокам).
   - Все контакты, все касания.
   - FAQ/Правила (редактирование, деактивация/восстановление, сортировка).
   - Журнал действий (фильтры).
   - Аналитика/Дашборд администратора.
 
### 4.3. Дашборд куратора (показатели)
- Количество контактов во всех его блоках (суммарно и/или с разбивкой по блокам).
- Количество касаний за последний месяц.
- Средний интервал между касаниями по активным контактам.
- Последние 5 касаний (дата, тип, результат).
- Список «Контакты, требующие внимания» — просроченный Next_touch_date.

 ### 4.4. Дашборд администратора (показатели)
 - Основные: активные блоки/кураторы; контакты (всего, новые, деактивированные за период); касания (за месяц, динамика); средние интервалы и интенсивность.
 - Повышенное внимание: контакты без касания > 30 дней; просроченные напоминания; блоки без активности > 14 дней.
 - Разрез по блокам: контакты, касания, функциональные связи, распределение типов влияния, средний статус влияния, активность кураторов.
 - Динамика касаний по результатам; топ‑контакты и топ‑кураторы.
 - Разрез по статусам влияния и их изменениям.
 - Watchlist‑раздел: уровни риска, новые за месяц, просроченные проверки, динамика рисков.
 
 
 ## 5. Управляемые справочники (reference values)
 
 - Статусы влияния (A/B/C/D) и их описание.
 - Типы влияния (навигационное, интерпретационное, функциональное, репутационное, аналитическое).
 - Каналы коммуникации.
 - Источники контактов.
 - Типы касаний.
 - Результаты касаний.
 - Статусы блока (Активный/Архив).
 - Орган/структура (для контактов).
 - Сфера риска (для Watchlist).
 - Разрешённые расширения файлов (для вложений).
 
 Правила:
 - Управление только администратором.
 - Деактивация вместо удаления; используемые значения можно деактивировать, но не удалять.
 - Деактивированные значения не доступны в новых формах, но остаются видимыми в существующих записях.
 
 
 ## 6. Watchlist (реестр потенциальных угроз)
 
 ### 6.1. Назначение
 - Не для выстраивания отношений, а для наблюдения и оценки угроз.
 - Примеры: бывшие клиенты/партнёры, конкуренты, чиновники/органы давления, инициаторы негативных публикаций/исков и т.п.
 
 ### 6.2. Поля
 - ФИО/псевдоним, роль/статус, сфера риска (из справочника), источник угрозы, дата возникновения, уровень риска, периодичность мониторинга, last_check/next_check, динамика, ответственный наблюдатель, материалы, updated_at/by.
 
 ### 6.3. Поведение
 - Доступ: администраторы и аналитики угроз (кураторы не имеют доступа).
 - Напоминания по next_check («пора обновить мониторинг»).
 - История изменений (WatchlistHistory): изменения уровня риска, периодичности, ответственного, значимые правки динамики.
 - Аудит всех изменений в общем журнале.
- **Watchlist НЕ поддерживает деактивацию записей** — все записи остаются активными; при необходимости можно изменить уровень риска или добавить комментарий в поле "динамика".
 
 
 ## 7. Политики безопасности (бизнес‑уровень)
 
 - MFA (TOTP) — обязательно для всех ролей; настройка при первом входе.
 - Создание пользователей — только администратором; логин и временный пароль передаются вручную.
 - Политика деактивации (мягкое удаление) — вместо физического удаления во всех реестрах, где применимо.
 - Доступ по блокам — куратор видит только свои блоки; статус «основной/резервный» влияет на отображение, но не ограничивает права внутри блока.
 - Аудит — обязательный, хранит старые/новые значения для всех изменений; доступен администратору.
 
 Примечание: требования к шифрованию формулируются как бизнес‑политика защиты чувствительных данных (ФИО, конфиденциальные примечания), без детализации конкретной реализации в данном документе.
 
 
 ## 8. Use Cases (ключевые сценарии)
 
 - UC‑1: Администратор создаёт блок и назначает кураторов.
 - UC‑2: Куратор добавляет новый контакт (ID по шаблону BLOCKCODE‑###; обновление Next_touch_date; аудит).
 - UC‑3: Куратор добавляет касание к контакту (обновление даты последнего касания, возможное изменение статуса влияния; аудит).
 - UC‑4: Куратор просматривает дашборд с напоминаниями (контакты, касания, просрочки).
 - UC‑5: Администратор просматривает аналитику по всем блокам.
 - UC‑6: Администратор просматривает журнал действий (фильтры).
 - UC‑7: Администратор управляет FAQ/Правила (редактирование, деактивация/восстановление, порядок).
 - UC‑8: Аналитик угроз добавляет запись в Watchlist (ответственный наблюдатель, напоминания, аудит).
 - UC‑9: Куратор ищет контакты по фильтрам.
 - UC‑10: Куратор просматривает историю изменения статуса контакта.
 - UC‑11: Администратор управляет справочниками (добавление/редактирование/деактивация/порядок).
 - UC‑12: Куратор со статусом «резервный» работает с контактами блока (параллельно с основным).
 
 
 --- 
 
 Данный документ предназначен для продукта‑оунера и бизнес‑стейкхолдеров: он описывает цели, роли, процессы, правила, интерфейс и сценарии без технических деталей реализации, архитектуры, стеков, БД и CI/CD. Техническая спецификация, архитектура и команды развёртывания остаются в `final.md`.
 

